#!/usr/bin/lua

local site = require 'gluon.site'
local uci = require('simple-uci').cursor()

local disabled = uci:get('network_gluon-old', 'mesh_wan', 'disabled')
if disabled == nil then
	disabled = not site.mesh_on_wan(false)
end

local transitive = uci:get('network_gluon-old', 'mesh_wan', 'transitive')
if transitive == nil then
	transitive = true
end

uci:section('network', 'interface', 'mesh_wan', {
	ifname = 'br-wan',
	proto = 'gluon_wired',
	index = 0,
	vxlan = site.mesh.vxlan(true),
	disabled = disabled,
	transitive = transitive,
})

uci:save('network')
